
<Project ToolsVersion="14.0">

  <PropertyGroup>
    <RazorLangVersion>8.0</RazorLangVersion>
  </PropertyGroup>

  <UsingTask TaskName="Microsoft.AspNetCore.Razor.Tasks.EncodeRazorInputItem" AssemblyFile=".\Microsoft.NET.Sdk.Razor.Tasks.dll" />

  <Target Name="_PrepareRazorSourceGenerators"
	BeforeTargets="GenerateMSBuildEditorConfigFileShouldRun">
	  
    <ItemGroup>
      <RazorComponent Include="@(Content)" Condition="'%(Content.Extension)'=='.razor'" />
    </ItemGroup>
	  
    <AssignTargetPath Files="@(RazorComponent)" RootFolder="$(MSBuildProjectDirectory)">
      <Output TaskParameter="AssignedFiles" ItemName="RazorComponentWithTargetPath" />
    </AssignTargetPath>
	  
    <ItemGroup>
      <RazorComponentWithTargetPath>
        <GeneratedOutput>Razor\%(RazorComponentWithTargetPath.TargetPath)</GeneratedOutput>
        <GeneratedDeclaration>RazorDeclaration\%(RazorComponentWithTargetPath.TargetPath)</GeneratedDeclaration>
      </RazorComponentWithTargetPath>

	  <RazorComponentWithTargetPath>
		<GeneratedOutputFullPath>$([System.IO.Path]::GetFullPath(%(GeneratedOutput)))</GeneratedOutputFullPath>
		<GeneratedDeclarationFullPath>$([System.IO.Path]::GetFullPath(%(GeneratedDeclaration)))</GeneratedDeclarationFullPath>
	  </RazorComponentWithTargetPath>
	</ItemGroup>

	<EncodeRazorInputItem RazorInputItems="@(RazorComponentWithTargetPath)">
		<Output TaskParameter="EncodedRazorInputItems" ItemName="_RazorSpecialCharacterWorkaround" />
	</EncodeRazorInputItem>

	<ItemGroup>
	  <AdditionalFiles Include="@(_RazorSpecialCharacterWorkaround)" />
	  <Analyzer Include=".\Build\Microsoft.CodeAnalysis.Razor.Compiler.dll;.\Build\Microsoft.AspNetCore.Razor.Utilities.Shared.dll;.\Build\Microsoft.Extensions.ObjectPool.dll;" />
	  <CompilerVisibleItemMetadata Include="AdditionalFiles" MetadataName="TargetPath" />
	  <CompilerVisibleProperty Include="RazorLangVersion" />
	</ItemGroup>
  </Target>

  <Target
    Name="RazorGenerateDesignTime"
    Returns="">
  </Target>

  <Target
    Name="RazorGenerateComponentDesignTime"
	Returns="">
  </Target>

</Project>
